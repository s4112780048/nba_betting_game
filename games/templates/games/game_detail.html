{% extends "base.html" %}
{% load tz %}
{% load static %}

{% block title %}æ¯”è³½è©³æƒ…{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="m-0">ğŸ“Œ æ¯”è³½è©³æƒ…</h3>
  <a class="btn btn-sm btn-ghost" href="{% url 'games:list' %}">â† å›è³½ç¨‹</a>
</div>

<div class="card p-3">
  <div class="text-muted small mb-2">
    é–‹è³½æ™‚é–“ï¼š
    {% if g.start_time %}
      {{ g.start_time|localtime|date:"Y/m/d H:i" }}
    {% else %}
      -
    {% endif %}
  </div>

  <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
    <div class="d-flex align-items-center gap-2">
      <img
        src="{% static 'team_logos/' %}{{ g.away_team.abbr|upper }}.svg"
        style="height:34px;width:auto"
        alt="{{ g.away_team.name }}"
        onerror="this.style.display='none'"
      >
      <div class="fw-bold fs-5">{{ g.away_team.abbr|default:g.away_team.name }}</div>
    </div>

    <div class="text-muted fs-5">@</div>

    <div class="d-flex align-items-center gap-2">
      <img
        src="{% static 'team_logos/' %}{{ g.home_team.abbr|upper }}.svg"
        style="height:34px;width:auto"
        alt="{{ g.home_team.name }}"
        onerror="this.style.display='none'"
      >
      <div class="fw-bold fs-5">{{ g.home_team.abbr|default:g.home_team.name }}</div>
    </div>
  </div>

  <hr class="my-3">

  <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
    <div>
      ç‹€æ…‹ï¼š
      {% if g.status == "scheduled" %}
        <span class="badge bg-secondary">Scheduled</span>
      {% elif g.status == "in_progress" %}
        <span class="badge bg-warning text-dark">In Progress</span>
      {% elif g.status == "final" %}
        <span class="badge bg-success">Final</span>
      {% else %}
        <span class="badge bg-dark">Unknown</span>
      {% endif %}
    </div>

    <div class="fs-4 fw-bold">
      {% if g.home_score is not None and g.away_score is not None %}
        {{ g.away_score }} - {{ g.home_score }}
      {% else %}
        -
      {% endif %}
    </div>
  </div>

  {% if g.status == "final" %}
    <div class="text-muted small mt-2">
      Winnerï¼š{% if g.winner %}{{ g.winner }}{% else %}-{% endif %}
    </div>
  {% endif %}
</div>

{% if user.is_authenticated %}
  <div class="card p-3 mt-3">
    <h5 class="mb-2">ğŸ’° ä¸‹æ³¨</h5>

    {% if g.status == "scheduled" or g.status == "in_progress" %}
      <form method="post" action="{% url 'betting:place' g.id %}" class="row g-2 align-items-end">
        {% csrf_token %}
        <div class="col-12 col-md-4">
          <label class="form-label">é¸æ“‡</label>
          <select class="form-select" name="pick" required>
            <option value="away">å®¢å‹ï¼š{{ g.away_team.abbr|default:g.away_team.name }}</option>
            <option value="home">ä¸»å‹ï¼š{{ g.home_team.abbr|default:g.home_team.name }}</option>
          </select>
        </div>

        <div class="col-12 col-md-4">
          <label class="form-label">é‡‘é¡</label>
          <input class="form-control" type="number" name="stake" min="1" step="1" value="100" required>
        </div>

        <div class="col-12 col-md-4">
          <button class="btn btn-accent w-100" type="submit">ä¸‹æ³¨</button>
        </div>
      </form>
    {% else %}
      <div class="text-muted">é€™å ´æ¯”è³½ç›®å‰ä¸å¯ä¸‹æ³¨ã€‚</div>
    {% endif %}
  </div>
{% else %}
  <div class="alert alert-info mt-3">
    è¦ä¸‹æ³¨è«‹å…ˆ <a href="{% url 'login' %}">ç™»å…¥</a>
  </div>
{% endif %}
{% endblock %}
