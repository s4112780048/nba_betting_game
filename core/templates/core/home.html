{% extends "base.html" %}
{% load static %}
{% load tz %}
{% block title %}Home{% endblock %}

{% block content %}
<div class="d-flex align-items-end justify-content-between flex-wrap gap-2 mb-3">
  <div>
    <h3 class="mb-1">ğŸ€ NBA Betting Dashboard</h3>
    <div class="text-muted small">å¿«é€Ÿä¸‹æ³¨ã€çœ‹æ’è¡Œã€é€›å•†åº—</div>
  </div>

  <div class="d-flex gap-2 flex-wrap">
    <a class="btn btn-ghost" href="{% url 'games:list' %}">çœ‹å®Œæ•´è³½ç¨‹</a>
    <a class="btn btn-ghost" href="{% url 'shop:list' %}">å‰å¾€å•†åº—</a>
    <a class="btn btn-ghost" href="{% url 'leaderboard:current' %}">æœ¬æœˆæ’è¡Œæ¦œ</a>
    {% if user.is_authenticated %}
      <a class="btn btn-accent" href="{% url 'accounts:wallet' %}">
        éŒ¢åŒ…{% if wallet %}ï¼š{{ wallet.balance }}{% endif %}
      </a>
    {% endif %}
  </div>
</div>

<div class="row g-3">
  <!-- Upcoming -->
  <div class="col-12 col-lg-7">
    <div class="card p-3 h-100">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
        <h5 class="mb-0">â³ å³å°‡é–‹è³½</h5>
        <div class="text-muted small">é¡¯ç¤º 10 å ´</div>
      </div>

      <div class="table-responsive mt-3">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th style="width:150px;">æ™‚é–“</th>
              <th>å°æˆ°</th>
              <th class="text-end" style="width:110px;"></th>
            </tr>
          </thead>
          <tbody>
          {% for g in upcoming %}
            <tr>
              <td class="text-muted small">
                {{ g.start_time|localtime|date:"m/d H:i" }}
              </td>
              <td>
                <div class="d-flex align-items-center gap-2 flex-wrap">
                  <div class="d-flex align-items-center gap-2">
                    {% if g.away_team.logo_url %}
                      <img src="{{ g.away_team.logo_url }}"
                           style="height:22px;width:auto" alt="{{ g.away_team.name }}"
                           onerror="this.style.display='none'">
                    {% endif %}
                    <span class="fw-semibold">{{ g.away_team.abbr|default:g.away_team.name }}</span>
                  </div>

                  <span class="text-muted">@</span>

                  <div class="d-flex align-items-center gap-2">
                    {% if g.home_team.logo_url %}
                      <img src="{{ g.home_team.logo_url }}"
                           style="height:22px;width:auto" alt="{{ g.home_team.name }}"
                           onerror="this.style.display='none'">
                    {% endif %}
                    <span class="fw-semibold">{{ g.home_team.abbr|default:g.home_team.name }}</span>
                  </div>
                </div>
              </td>
              <td class="text-end">
                <a class="btn btn-sm btn-accent" href="{% url 'games:detail' g.id %}">ä¸‹æ³¨</a>
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="3" class="text-muted">æ²’æœ‰å³å°‡é–‹è³½çš„è³‡æ–™ï¼ˆå…ˆè·‘ python manage.py sync_scores_espnï¼‰</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Leaderboard -->
  <div class="col-12 col-lg-5">
    <div class="card p-3 h-100">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
        <h5 class="mb-0">ğŸ† æœ¬æœˆæ’è¡Œæ¦œ</h5>
        <div class="text-muted small">{{ month }}</div>
      </div>

      <div class="table-responsive mt-3">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th style="width:60px;">#</th>
              <th>ç©å®¶</th>
              <th class="text-end" style="width:90px;">Profit</th>
              <th class="text-end" style="width:90px;">W-L</th>
            </tr>
          </thead>
          <tbody>
          {% for row in top10 %}
            <tr>
              <td class="text-muted small">{{ forloop.counter }}</td>
              <td class="fw-semibold">{{ row.user.username }}</td>
              <td class="text-end fw-semibold">{{ row.profit }}</td>
              <td class="text-end text-muted">{{ row.wins }}-{{ row.losses }}</td>
            </tr>
          {% empty %}
            <tr><td colspan="4" class="text-muted">æœ¬æœˆå°šç„¡æ’è¡Œè³‡æ–™</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="mt-2">
        <a class="btn btn-sm btn-ghost" href="{% url 'leaderboard:current' %}">çœ‹æ›´å¤š</a>
      </div>
    </div>
  </div>

  <!-- Shop -->
  <div class="col-12">
    <div class="card p-3">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
        <h5 class="mb-0">ğŸ›’ å•†åº—ç²¾é¸</h5>
        <a class="btn btn-sm btn-ghost" href="{% url 'shop:list' %}">å…¨éƒ¨å•†å“</a>
      </div>

      <div class="row g-3 mt-1">
        {% for it in featured_items %}
          <div class="col-12 col-md-6 col-lg-4">
            <div class="card p-3">
              <div class="d-flex align-items-start justify-content-between gap-2">
                <div>
                  <div class="fw-bold">{{ it.name }}</div>
                  <div class="text-muted small">{{ it.code }}</div>
                </div>
                <span class="badge bg-warning text-dark">{{ it.price }}</span>
              </div>
              {% if it.description %}
                <div class="text-muted small mt-2">{{ it.description }}</div>
              {% endif %}
              <div class="mt-3">
                <a class="btn btn-sm btn-accent" href="{% url 'shop:list' %}">å»è³¼è²·</a>
              </div>
            </div>
          </div>
        {% empty %}
          <div class="text-muted">å•†åº—ç›®å‰æ²’æœ‰å•†å“</div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
